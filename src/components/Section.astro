---
import "../styles/components/section.css";

interface Props {
    id?: string;
    title?: string;
    subtitle?: string;
    background?: "white" | "light" | "dark";
    centered?: boolean;
    paddingTop?: "small" | "medium" | "large";
    paddingBottom?: "small" | "medium" | "large";
    image?: string;
    imagePosition?: "left" | "right";
    imageSize?: string;
    titleAlignment?: "left" | "center" | "right";
}

const {
    id,
    title,
    subtitle,
    background = "white",
    centered = false,
    paddingTop = "large",
    paddingBottom = "large",
    image,
    imagePosition = "right",
    imageSize = "300px",
    titleAlignment = "center",
} = Astro.props;

const paddingClasses = `pt-${paddingTop} pb-${paddingBottom}`;
const bgClass = `bg-${background}`;
const textAlign = centered ? "centered" : "";
const titleAlignClass = title ? `title-${titleAlignment}` : "";
---

<section
    id={id}
    class={`section ${bgClass} ${paddingClasses} ${textAlign} ${titleAlignClass}`}
>
    <div class="container">
        {
            title && (
                <div class="section-header">
                    <h2 class="section-title">{title}</h2>
                    {subtitle && <p class="section-subtitle">{subtitle}</p>}
                </div>
            )
        }

        {
            image ? (
                <div class={`content-row image-${imagePosition}`}>
                    {imagePosition === "left" && (
                        <img
                            src={image}
                            alt=""
                            class="section-image"
                            style={`width: ${imageSize}; height: auto;`}
                        />
                    )}
                    <div class="section-content">
                        <slot />
                    </div>
                    {imagePosition === "right" && (
                        <img
                            src={image}
                            alt=""
                            class="section-image"
                            style={`width: ${imageSize}; height: auto;`}
                        />
                    )}
                </div>
            ) : (
                <div class="section-content">
                    <slot />
                </div>
            )
        }
    </div>
</section>

<script type="module">
    if (typeof window !== "undefined") {
        // Avoid installing multiple observers if the component renders many times
        if (!window.__sectionsObserverInitialized) {
            window.__sectionsObserverInitialized = true;

            const observer = new IntersectionObserver(
                (entries, obs) => {
                    entries.forEach((entry) => {
                        const el = entry.target;
                        if (entry.isIntersecting) {
                            el.classList.add("in-view");
                            el.classList.remove("will-blur");
                            obs.unobserve(el);
                        }
                    });
                },
                { root: null, rootMargin: "0px 0px -10% 0px", threshold: 0.15 },
            );

            // Observe all section elements on the page and mark them initially to be blurred.
            document.querySelectorAll("section.section").forEach((s) => {
                s.classList.add("will-blur");
                observer.observe(s);
            });
        }
    }
</script>
